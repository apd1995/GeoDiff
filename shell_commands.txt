export GCSFUSE_REPO=gcsfuse-`lsb_release -c -s`
echo "deb https://packages.cloud.google.com/apt $GCSFUSE_REPO main" | sudo tee /etc/apt/sources.list.d/gcsfuse.list
curl https://packages.cloud.google.com/apt/doc/apt-key.gpg | sudo apt-key add -
sudo apt-get update
sudo apt-get install fuse gcsfuse
gcsfuse -v

gcloud auth application-default login
mkdir "$HOME/bucket"
gcsfuse --implicit-dirs hs-deep-lab-donoho-seasia "$HOME/bucket"

fusermount -u "$HOME/bucket"



git clone https://github.com/apd1995/GeoDiff
cd GeoDiff
git checkout awd-patch-1



conda create -n geodiff python=3.10 -c conda-forge
conda create -n geodiff python=3.7 numpy mkl -c conda-forge
conda env create --file=env.yml
conda activate geodiff
conda install PyYAML EasyDict
conda install pytorch torchvision torchaudio pytorch-cuda=12.1 -c pytorch -c nvidia
conda install pytorch==1.8.1 torchvision==0.9.1 torchaudio==0.8.1 cudatoolkit=11.3 -c pytorch -c conda-forge
conda install pyg=*=*cu* -c pyg
conda install pytorch-scatter pytorch-sparse pytorch-cluster pytorch-spline-conv -c pyg
conda install pytorch-scatter pytorch-sparse -c pyg
conda install pytorch-cluster pytorch-spline-conv -c pyg
conda install rdkit=2020.09.1
conda install rdkit=2022.03.1


python test.py ../bucket/data/GEOM/checkpoints/${iter}.pt --start_idx 800 --end_idx 1000
python test.py ./logs/drugs_1k_default_2024_03_24__22_50_36/checkpoints/100000.pt --test_set ../bucket/data/GEOM/Drugs/train_data_40k.pkl --start_idx 0 --end_idx 100 --n_steps 1000
python test.py ./logs/drugs_1k_default_2024_03_24__22_50_36/checkpoints/100000.pt --test_set ../bucket/data/GEOM/Drugs/train_data_40k.pkl --start_idx 1259 --end_idx 4000 --n_steps 1000



mamba env remove -n geodiff
mamba create -n geodiff python=3.10 -c conda-forge 
conda activate geodiff
mamba install PyYAML EasyDict
mamba install pytorch::pytorch torchvision torchaudio -c pytorch
mamba install pyg -c pyg
mamba install pytorch-scatter pytorch-sparse pytorch-cluster pytorch-spline-conv -c pyg
mamba install rdkit=2020.09.1
# First version to support python v3.10.*
mamba install rdkit=2022.03.1




gcloud compute instances create instance-20240326-213845 --project=hs-deep-lab-donoho --zone=asia-southeast1-c --machine-type=a2-highgpu-1g --network-interface=network-tier=PREMIUM,stack-type=IPV4_ONLY,subnet=default --maintenance-policy=TERMINATE --provisioning-model=STANDARD --service-account=429683943466-compute@developer.gserviceaccount.com --scopes=https://www.googleapis.com/auth/devstorage.read_only,https://www.googleapis.com/auth/logging.write,https://www.googleapis.com/auth/monitoring.write,https://www.googleapis.com/auth/servicecontrol,https://www.googleapis.com/auth/service.management.readonly,https://www.googleapis.com/auth/trace.append --accelerator=count=1,type=nvidia-tesla-a100 --create-disk=auto-delete=yes,boot=yes,device-name=instance-20240326-213845,image=projects/ml-images/global/images/c0-deeplearning-common-cu121-v20240306-debian-11,mode=rw,size=500,type=projects/hs-deep-lab-donoho/zones/asia-southeast1-c/diskTypes/pd-balanced --no-shielded-secure-boot --shielded-vtpm --shielded-integrity-monitoring --labels=goog-ec-src=vm_add-gcloud --reservation-affinity=any



# For macOS & PyTorch v2.1.2
mamba create -n confgf python=3.10 numpy mkl -c conda-forge
conda activate confgf
mamba install EasyDict PyYAML
mamba install -y -c rdkit rdkit
mamba install pytorch==2.1.2 torchvision==0.16.2 torchaudio==2.1.2 -c pytorch
mamba install pyg -c pyg
mamba install pytorch-scatter pytorch-sparse pytorch-cluster pytorch-spline-conv -c pyg
mamba install -y scikit-learn pandas decorator ipython networkx tqdm matplotlib
mamba env export --from-history >env-awd.yml



# For macOS & PyTorch v2.1.2
mamba create -n geodiff python=3.10 numpy mkl -c conda-forge
conda activate geodiff
mamba install EasyDict PyYAML
mamba install -y -c rdkit rdkit
mamba install pytorch==2.1.2 torchvision==0.16.2 torchaudio==2.1.2 -c pytorch
mamba install pyg -c pyg
mamba install pytorch-scatter pytorch-sparse pytorch-cluster pytorch-spline-conv -c pyg
mamba env export --from-history >env-awd.yml





# For Debian & PyTorch v1.8.1
~/miniforge3/bin/mamba create -n geodiff python=3.7 numpy mkl -c conda-forge
conda activate geodiff
~/miniforge3/bin/mamba install -y PyYAML EasyDict
~/miniforge3/bin/mamba install -y rdkit=2020.09.1 -c rdkit
~/miniforge3/bin/mamba install -y pytorch==1.8.1 torchvision==0.9.1 torchaudio==0.8.1 cudatoolkit=11.3 -c pytorch -c conda-forge
~/miniforge3/bin/mamba install pytorch torchvision torchaudio cudatoolkit=11.3 -c pytorch-lts -c nvidia
~/miniforge3/bin/mamba install pytorch-geometric=1.7.2=py37_torch_1.8.2_cu113 -c rusty1s -c conda-forge
~/miniforge3/bin/mamba install -y pyg=*=*cu* -c pyg
~/miniforge3/bin/mamba install pytorch-scatter pytorch-sparse pytorch-cluster pytorch-spline-conv -c pyg
conda install rdkit=2022.03.1
